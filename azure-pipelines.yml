trigger:
  - master

variables:
  system.debug: true
  imageName: 'vuejs-app'
  azureContainerRegistry: 'VuejsContainerServiceConnection'  # Replace with the actual service connection name
  azureSubscription: 'VuejsDemoDockerServiceConnection'       # Replace with the actual Azure service connection name
  azureResourceGroup: 'VuejsDemoDocker_group'
  appName: 'VuejsDemoDocker'

pool:
  vmImage: 'ubuntu-latest'

steps:
  # - task: NodeTool@0
  #   inputs:
  #     versionSpec: '20.x'
  #   displayName: 'Install Node.js'

  # - script: |
  #     npm install
  #     npm run build
  #   displayName: 'Install dependencies and build Vue.js app'

  - task: Docker@2
    inputs:
      containerRegistry: '$(azureContainerRegistry)'
      repository: '$(imageName)'
      command: 'buildAndPush'
      Dockerfile: '**/Dockerfile'
      tags: |
        $(Build.BuildId)
    displayName: 'Build and push Docker image'

  - task: AzureWebAppContainer@1
    inputs:
      azureSubscription: '$(azureSubscription)'
      appName: '$(appName)'
      imageName: '$(imageName):$(Build.BuildId)'
    displayName: 'Deploy to Azure Web App'
